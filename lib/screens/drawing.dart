import 'dart:convert';
import 'package:flutter/material.dart';

class CustomDraw extends StatelessWidget {
  CustomDraw({Key? key}) : super(key: key);

  final String _data =
      '{"vectors":{"0":[[-0.140834153,-0.158451378,0.128803656],[-0.140834153,-0.158451378,0.128803656],[-0.140336156,-0.158302575,0.129143089],[-0.139986828,-0.15807429,0.12945734],[-0.139007136,-0.158198655,0.12985751],[-0.131828591,-0.163775757,0.125827551],[-0.127844051,-0.167968035,0.122808121],[-0.124865755,-0.1708757,0.1208587],[-0.122065134,-0.1743004,0.118195005],[-0.119687818,-0.178240016,0.114813454],[-0.11735259,-0.181554168,0.112083592],[-0.114190333,-0.18612051,0.108124569],[-0.11095468,-0.190488011,0.104463674],[-0.107230633,-0.195615977,0.100456707],[-0.102961361,-0.200779453,0.0963000357],[-0.09865801,-0.205336556,0.09271601],[-0.0945175439,-0.209993765,0.08883811],[-0.09092741,-0.213870674,0.08558765],[-0.0882745758,-0.216990337,0.08293708],[-0.08618195,-0.2204236,0.08000431],[-0.08487916,-0.2228829,0.07784212],[-0.0843482763,-0.2236776,0.07739307],[-0.08441739,-0.223792225,0.07757105]],"1":[[-0.134585887,-0.1662149,0.140176535],[-0.134585887,-0.1662149,0.140176535],[-0.134507969,-0.1662542,0.140347],[-0.134521067,-0.1661775,0.140473858],[-0.13129963,-0.1629737,0.145110071],[-0.129416764,-0.162304491,0.146847442],[-0.127707332,-0.16162847,0.1485307],[-0.126318365,-0.160746574,0.1505951],[-0.124535933,-0.158793285,0.153702214],[-0.1213465,-0.155834109,0.158227],[-0.116654813,-0.1532074,0.162647516],[-0.1119388,-0.151029885,0.166721448],[-0.107688144,-0.148191854,0.171314925],[-0.103419393,-0.145902053,0.175230086],[-0.10065601,-0.144863948,0.1773977],[-0.0994203,-0.144459933,0.178504139]],"2":[[-0.105889991,-0.194712922,0.122131363],[-0.105889991,-0.194712922,0.122131363],[-0.10571795,-0.194665059,0.122160494],[-0.105194859,-0.194733649,0.122212134],[-0.100926228,-0.194443867,0.1240319],[-0.09698911,-0.194744021,0.125298545],[-0.09193287,-0.192663223,0.129609346],[-0.086889565,-0.1892113,0.135498554],[-0.08227874,-0.1867028,0.140113711],[-0.07752131,-0.184776351,0.143900365],[-0.07457848,-0.1828673,0.147181883],[-0.07312123,-0.181346044,0.1496007],[-0.0721275061,-0.1805291,0.1510089]],"3":[[-0.03659184,-0.146158412,0.189657852],[-0.03659184,-0.146158412,0.189657852],[-0.0364200659,-0.145932719,0.190202773],[-0.03632641,-0.145734951,0.190671042],[-0.0361289345,-0.145727843,0.19092463],[-0.0356878266,-0.14590922,0.19113341],[-0.0349817649,-0.146152779,0.191378653],[-0.0325087458,-0.148525491,0.18965365],[-0.0307326764,-0.150650963,0.188122183],[-0.0293261465,-0.1530215,0.186198488],[-0.0279021841,-0.155118957,0.184503108],[-0.0256091114,-0.157962352,0.1819343],[-0.0223960727,-0.16257225,0.177335054],[-0.0179412551,-0.166796923,0.173343],[-0.01317724,-0.171808928,0.168496385],[-0.009057557,-0.175932929,0.16459626],[-0.00621996075,-0.178597733,0.162254184],[-0.004057463,-0.18114537,0.15989545],[-0.002551056,-0.183386415,0.157755062],[-0.00192795,-0.184918642,0.156670779],[-0.001688008,-0.185523987,0.156444684]],"4":[[-0.04881085,-0.13220349,0.210492134],[-0.04881085,-0.13220349,0.210492134],[-0.0495372042,-0.131605744,0.2107825]],"5":[[0.00159453135,-0.124812379,0.211660221],[0.00159453135,-0.124812379,0.211660221],[0.002053068,-0.12459451,0.21179989],[0.00256620534,-0.124276146,0.211944073],[0.002817573,-0.124537386,0.2119307],[0.00336462818,-0.124943741,0.21200496],[0.0061514955,-0.122832224,0.214909345],[0.0103591047,-0.123031363,0.215655491],[0.0152835036,-0.122883514,0.216743186],[0.02033661,-0.1230215,0.217423141],[0.0253583658,-0.124250188,0.216698438],[0.03011794,-0.127141654,0.2139977],[0.03424003,-0.131358773,0.209754378],[0.0376461744,-0.134526625,0.206513882],[0.04078365,-0.1371553,0.203798562],[0.0436803475,-0.14013949,0.2007345],[0.0452753827,-0.142544419,0.198947564],[0.0458982065,-0.143750519,0.198223054],[0.04608873,-0.143918917,0.198253155],[0.0457345359,-0.143924654,0.1983523],[0.0432960838,-0.141572684,0.2008267],[0.0406763777,-0.137786165,0.204855889],[0.03792441,-0.134815663,0.208378136],[0.03575421,-0.130952,0.212534115],[0.0341554,-0.1270493,0.21653159],[0.03280054,-0.123255834,0.220247462],[0.03177862,-0.119083077,0.2243634],[0.031545423,-0.115760729,0.227760747],[0.03160994,-0.11311467,0.2312237],[0.0320798345,-0.110342875,0.234690517],[0.0333630219,-0.108611353,0.2370877],[0.03698196,-0.107841775,0.23856388],[0.04110843,-0.107892334,0.23909235],[0.0451116078,-0.10805963,0.239348188],[0.0488420129,-0.108119383,0.23980318],[0.053345222,-0.108163252,0.24023816],[0.058050625,-0.108933553,0.2399388],[0.06322287,-0.110078022,0.2392026],[0.06990585,-0.112247936,0.2373864],[0.07610343,-0.116075121,0.233859718],[0.0807395652,-0.119780242,0.230939865],[0.08496005,-0.122805327,0.2285519],[0.0881181359,-0.126102462,0.22569257],[0.09072344,-0.1289396,0.223210961],[0.09284109,-0.130348414,0.22221905]],"6":[[0.151380137,-0.0560112,0.257956147],[0.151380137,-0.0560112,0.257956147],[0.151931763,-0.0557516143,0.25803557],[0.1522615,-0.0553130135,0.258126259],[0.152036726,-0.0556056947,0.258144349],[0.152201742,-0.0560851842,0.258198172],[0.153203458,-0.05657337,0.2580854],[0.150214881,-0.05602932,0.2594644],[0.14664796,-0.0572315678,0.259987235],[0.141780719,-0.056990087,0.261324346],[0.135385364,-0.0570415929,0.2621855],[0.128890485,-0.05734857,0.262506932],[0.121787988,-0.0579861552,0.2623161],[0.115522057,-0.06052281,0.260356784],[0.110850431,-0.0630039945,0.2593009],[0.10818401,-0.0653321,0.2576845],[0.107346304,-0.06878181,0.2549808],[0.107685015,-0.07305659,0.251542449],[0.108322375,-0.0762018859,0.248978138],[0.108897924,-0.0786013454,0.246961534],[0.11097461,-0.0825657,0.244520172],[0.115048423,-0.0857102647,0.241826221],[0.120008633,-0.0873960853,0.23999919],[0.126909673,-0.08829487,0.238566563],[0.133540973,-0.08830092,0.237881839],[0.139568076,-0.08780291,0.2376644],[0.144368827,-0.08670114,0.2384654],[0.147949189,-0.08421194,0.240181476],[0.150110647,-0.08033907,0.243034571],[0.151119441,-0.07483232,0.247277036],[0.15186137,-0.07021365,0.250678718],[0.152282208,-0.0653800145,0.254192084],[0.151973575,-0.0608927,0.257848442],[0.150319934,-0.0572497249,0.2607578],[0.1482972,-0.0530636758,0.2642128],[0.14644821,-0.0499960333,0.266710818],[0.1449759,-0.04879289,0.2675778],[0.1443731,-0.0485273376,0.267578],[0.143872276,-0.04847733,0.267887831],[0.1440751,-0.048461996,0.267809927],[0.144493967,-0.0490052253,0.26711002],[0.146230489,-0.05041255,0.2655274],[0.148829848,-0.0537319481,0.262180716],[0.151375964,-0.0569392741,0.258843869],[0.1538665,-0.05934713,0.256158322],[0.157062709,-0.06296899,0.2523726],[0.160797983,-0.06628306,0.248976141],[0.1645044,-0.0688089,0.2464379],[0.16936262,-0.0714203045,0.24413462],[0.175625041,-0.07317001,0.242381841],[0.181048661,-0.0734553859,0.241935611],[0.185447872,-0.0733101,0.2419566]],"7":[[0.157494336,0.04498802,0.3211677],[0.157494336,0.04498802,0.3211677],[0.157248214,0.0453348234,0.321215838],[0.1569344,0.0456038266,0.321266353],[0.156198025,0.0450105146,0.321520448],[0.156960934,0.04515344,0.3221614],[0.159412608,0.0450898036,0.322153956],[0.162463889,0.0442795977,0.321543038],[0.164673775,0.042507492,0.3209597],[0.166588023,0.0410960838,0.320181966],[0.1690622,0.03872253,0.318569481],[0.172098815,0.0354118347,0.3162587],[0.1750308,0.0316483,0.313662469],[0.177604556,0.0282705426,0.311393321],[0.179990545,0.0243398622,0.308720767],[0.182444587,0.0198516473,0.305600166],[0.184761539,0.0155208483,0.303496748],[0.18731232,0.0121104121,0.301366627],[0.189457834,0.008526042,0.298957855],[0.191827685,0.005109273,0.2965611],[0.194648787,0.00204464048,0.2943445],[0.198343843,-0.0008378923,0.292058229],[0.201778829,-0.00481005758,0.2897131],[0.2054592,-0.008606613,0.2868518],[0.209055156,-0.0119729489,0.283975035],[0.212651312,-0.0155320168,0.280772328],[0.215727657,-0.0187029168,0.277891338],[0.2180927,-0.0212668628,0.275535077],[0.220022619,-0.0235549286,0.273850262],[0.221520811,-0.0250537843,0.2724447],[0.222634733,-0.0263798162,0.271102756],[0.223295018,-0.0266881064,0.270425558],[0.223662227,-0.02674684,0.269882441],[0.224099025,-0.026591897,0.269377679],[0.224794179,-0.0265494213,0.268953],[0.22575,-0.0264041349,0.268513471],[0.226646483,-0.0260959417,0.268232167],[0.227550447,-0.0258671865,0.267966181],[0.228720158,-0.0256456286,0.2677219],[0.230152369,-0.0258280709,0.267301261],[0.232114136,-0.0258635581,0.266775221],[0.234977782,-0.0249368623,0.266714662],[0.238357335,-0.0233738348,0.2669064],[0.241739184,-0.0210076869,0.267597854],[0.24439919,-0.0183282569,0.268654644],[0.246608824,-0.015995279,0.2700944],[0.2492038,-0.0132304132,0.2714202],[0.251713634,-0.009921186,0.273053348],[0.254603028,-0.00630977,0.274835318],[0.257324368,-0.00292807817,0.276534677],[0.2596954,-0.000181123614,0.2779505],[0.262506336,0.00240769237,0.279207915],[0.265664518,0.004696399,0.280552059],[0.26908505,0.006778784,0.281591058],[0.2723359,0.008428946,0.282338321],[0.27476567,0.009578951,0.282864958],[0.27576,0.00954923,0.282862067],[0.275905252,0.00903447,0.28270036],[0.274835825,0.008150302,0.282784462],[0.273129851,0.007270336,0.282777965],[0.2717408,0.005945593,0.28224954]],"8":[[-0.101087771,-0.298437268,0.0583570451],[-0.101087771,-0.298437268,0.0583570451],[-0.100830078,-0.298220158,0.0587147325],[-0.100539774,-0.298071176,0.05908963],[-0.100188106,-0.297931582,0.0595640838],[-0.09986649,-0.297853857,0.05999901],[-0.09952621,-0.297835618,0.0605125166],[-0.0988026559,-0.2979309,0.0608815029],[-0.09544539,-0.29639414,0.06386109],[-0.09265644,-0.29493323,0.06666681],[-0.08854778,-0.29333955,0.06996274],[-0.08345354,-0.291664243,0.07357983],[-0.0787282661,-0.290407181,0.0766087845],[-0.07322719,-0.28896004,0.07971361],[-0.0682345554,-0.287142754,0.08319467],[-0.0639562,-0.285337329,0.08647568],[-0.05994409,-0.28359127,0.08958722],[-0.05595803,-0.281738549,0.0927963257],[-0.05150621,-0.280205965,0.0953064561],[-0.04744511,-0.2788346,0.09778798],[-0.04385647,-0.277420431,0.10024187],[-0.03988962,-0.275916517,0.102843456],[-0.0359106325,-0.274149984,0.105722614],[-0.0318617,-0.272209883,0.108753666],[-0.0275345,-0.270431548,0.11164479],[-0.02327045,-0.268623054,0.11441882],[-0.01860303,-0.2669295,0.117051184],[-0.0136681795,-0.265139431,0.119754717],[-0.008203205,-0.26312387,0.122732572],[-0.002732221,-0.261024922,0.1257429],[0.00295043364,-0.258712322,0.129027247],[0.008751374,-0.2560769,0.1324836],[0.0151558826,-0.253557146,0.135789543],[0.0220267586,-0.251153,0.138995335],[0.028977517,-0.2489939,0.141925961],[0.03591873,-0.247170165,0.144456968],[0.042736657,-0.24525544,0.146655381],[0.04939667,-0.243578136,0.148825392],[0.05647673,-0.241904989,0.151100084],[0.06328202,-0.239905879,0.153706238],[0.0698963851,-0.237417608,0.156713322],[0.07685053,-0.23400192,0.160512954],[0.08393861,-0.230468735,0.164219648],[0.09078589,-0.2266946,0.167629],[0.0976335853,-0.223266169,0.170825079],[0.104194239,-0.219720572,0.174128935],[0.110357344,-0.216246977,0.17731595],[0.115425438,-0.212823272,0.180381745],[0.119943559,-0.20947437,0.183264643],[0.124327227,-0.206759289,0.185638875],[0.1282912,-0.204511061,0.187358022],[0.132738456,-0.20232749,0.188970089],[0.137416914,-0.200053349,0.190596849],[0.141722888,-0.197741881,0.192197829],[0.146166086,-0.195100442,0.194077715],[0.151090965,-0.192904547,0.196142673],[0.155993983,-0.190275878,0.198144048],[0.161124259,-0.187828228,0.199733],[0.166168451,-0.185329735,0.201196373],[0.171351135,-0.1828609,0.202521086],[0.176228523,-0.180415392,0.203837872],[0.1812881,-0.177677289,0.205919936],[0.18630749,-0.174804479,0.207924142],[0.1914548,-0.17218563,0.209652334],[0.196286291,-0.169656336,0.21128808],[0.201019108,-0.167445838,0.212568134],[0.205415145,-0.165239736,0.213828325],[0.209494621,-0.16304493,0.215393677],[0.213238075,-0.1608464,0.216961309],[0.216648832,-0.158732742,0.218495],[0.22039935,-0.156773567,0.219847873],[0.22433506,-0.1548358,0.221180886],[0.228109658,-0.152956873,0.2224948],[0.232089341,-0.150863379,0.224375173],[0.236213475,-0.148479134,0.22618705],[0.240313709,-0.146010578,0.227976933],[0.244466662,-0.143632367,0.229618683],[0.248945266,-0.14186886,0.230712056],[0.253249139,-0.140273258,0.231810465],[0.256668627,-0.13893196,0.233322978],[0.259723961,-0.137388051,0.23477228],[0.262926817,-0.135323972,0.236525342],[0.266013026,-0.133260578,0.238219485],[0.268429339,-0.131592259,0.239724755],[0.270399123,-0.1299068,0.241435289],[0.272087783,-0.128658846,0.243277013],[0.273604482,-0.127352908,0.244887248],[0.2750175,-0.1259862,0.24655734],[0.2765427,-0.124417558,0.248358279],[0.2784943,-0.122599073,0.250127047],[0.280661047,-0.120847911,0.251644731]]}}';

  @override
  Widget build(BuildContext context) {
    return SingleChildScrollView(
      scrollDirection: Axis.horizontal,
      child: Row(
        children: [
          DoodlePreview(
            vectors: _data,
          )
        ],
      ),
    );
  }
}

class DoodlePreview extends StatelessWidget {
  const DoodlePreview({Key? key, this.vectors}) : super(key: key);
  final vectors;

  @override
  Widget build(BuildContext context) {
    return ClipRRect(
        borderRadius: BorderRadius.circular(15),
        child: Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(15),
            border: Border.all(color: Colors.black12, width: 1),
          ),
          child: CustomPaint(
            size: const Size(300, 200),
            painter: MyPainter(vectors: vectors),
          ),
        ));
  }
}

class MyPainter extends CustomPainter {
  const MyPainter({required this.vectors});
  final vectors;

  @override
  void paint(Canvas canvas, Size size) {
    List<Offset> vecs = [];

    final lines = jsonDecode(vectors)["lines"];
    double lowerX = 0;
    double upperX = 0;

    double lowerY = 0;
    double upperY = 0;

    for (var line in lines) {
      for (var vec in line["vectors"]) {
        vec[0] *= -1;

        if (vec[0] < lowerX) {
          lowerX = vec[0];
        } else if (vec[0] > upperX) {
          upperX = vec[0];
        }

        if (vec[1] < lowerY) {
          lowerY = vec[1];
        } else if (vec[1] > upperY) {
          upperY = vec[1];
        }
      }
    }

    for (var line in lines) {
      final path = Path();
      int count = 0;

      final paint = Paint()
        ..color = Colors.black
        ..style = PaintingStyle.stroke
        ..strokeCap = StrokeCap.round
        ..strokeJoin = StrokeJoin.round
        ..strokeWidth = 4;

      for (var vec in line["vectors"]) {
        double xVal = vec[0];
        xVal = (xVal - lowerX) / (upperX - lowerX);

        double yVal = vec[1];
        yVal = (yVal - lowerY) / (upperY - lowerY);

        double x = -xVal * (size.width - 80) + 40 + size.width / 2;
        double y = -yVal * (size.height - 80) + 40 + size.height / 2;

        if (count == 0) {
          path.moveTo(x, y);
        } else {
          path.lineTo(x, y);
        }

        count++;
      }

      canvas.drawPath(path, paint);
    }
  }

  @override
  bool shouldRepaint(CustomPainter old) {
    return false;
  }
}
